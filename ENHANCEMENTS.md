# Улучшения RAID Monitor на основе calomel.org

## Обзор изменений

Скрипт был значительно улучшен на основе проверенного решения от [calomel.org](https://calomel.org/megacli_lsi_commands.html). Все функции адаптированы для современной утилиты `storcli` вместо устаревшей `MegaCLI`.

## Новые функции

### 1. **Мониторинг BBU/CacheVault**
- **Умная детекция типа компонента** - автоматическое определение BBU или CacheVault
- **Проверка состояния батареи** (только для BBU)
- **Мониторинг температуры** (только для CacheVault)
- **Контроль уровня заряда** (только для BBU)
- **Правильная обработка отсутствия компонента** - если нет BBU/CacheVault, это не ошибка

### 2. **Детальная диагностика ошибок дисков**
- Анализ SMART атрибутов каждого диска
- Подсчет ошибок чтения/записи
- Мониторинг предсказательных отказов
- Детальная проверка счетчиков ошибок

### 3. **Мониторинг фоновых операций**
- Проверка прогресса rebuild
- Мониторинг patrol read
- Отслеживание инициализации дисков
- Контроль фоновых задач контроллера

### 4. **Анализ логов контроллера**
- Парсинг событий контроллера
- Анализ аварийных сигналов
- Мониторинг недавних ошибок
- Детальная история событий

### 5. **Улучшенная детекция состояний**
- Более точный парсинг вывода storcli
- Проверка всех возможных состояний дисков
- Улучшенная классификация ошибок
- Более надежная детекция проблем

## Адаптация команд

| Функция | MegaCLI (calomel.org) | storcli (наша версия) |
|---------|----------------------|----------------------|
| Состояние контроллера | `MegaCli -LDInfo -Lall -aALL` | `storcli /c0 /vall show` |
| Физические диски | `MegaCli -PDlist -aALL` | `storcli /c0 /eall /sall show` |
| BBU статус | `MegaCli -AdpBbuCmd -GetBbuStatus` | `storcli /c0 /cv show` |
| Фоновые операции | `MegaCli -LDCC -ShowProg` | `storcli /c0 show bgi` |
| События | `MegaCli -AdpEventLog -GetEvents` | `storcli /c0 show events` |
| SMART статус | `MegaCli -PDlist -aALL` | `storcli /c0/eX/sY show smart` |
| Ошибки дисков | `MegaCli -PDlist -aALL` | `storcli /c0/eX/sY show phyerrorcounters` |

## Преимущества улучшенной версии

### ✅ **Более точная диагностика**
- Детальная проверка каждого компонента
- Анализ SMART атрибутов
- Мониторинг предсказательных отказов

### ✅ **Лучшая производительность**
- Проверка состояния BBU (критично для кэширования)
- Мониторинг фоновых операций
- Контроль температуры компонентов

### ✅ **Расширенная отчетность**
- Анализ логов контроллера
- Детальная информация о событиях
- История ошибок и предупреждений

### ✅ **Современная совместимость**
- Использование актуальной утилиты storcli
- Поддержка новых контроллеров LSI
- Улучшенный парсинг вывода

## Файлы

- `raid_monitor_enhanced.sh` - улучшенная версия основного скрипта
- `calomel_analysis.md` - детальный анализ адаптации функций
- `ENHANCEMENTS.md` - данный файл с описанием улучшений

## Благодарности

Особая благодарность команде [calomel.org](https://calomel.org/megacli_lsi_commands.html) за создание отличного базового скрипта, который послужил основой для наших улучшений.
